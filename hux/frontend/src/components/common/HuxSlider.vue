<template>
  <transition>
    <v-range-slider
      class="hux-range-slider"
      :max="max"
      :min="min"
      :step="step"
      thumb-label="always"
      v-if="isRangeSlider"
      v-model="localValue"
      @end="onFinalValue"
    ></v-range-slider>
    <v-slider
      class="hux-score-slider"
      always-dirty
      :color="currentColor"
      :readonly="readOnly"
      :track-color="currentColor"
      v-else
      v-model="currentValue"
      @end="onFinalValue"
    >
      <template #append>
        <span
          class="slider-value-display"
          :style="{
            color: currentColor,
          }"
          v-text="currentValue + '%'"
        ></span>
      </template>
    </v-slider>
  </transition>
</template>

<script>
import colors from "../../plugins/colors"

export default {
  name: "hux-slider",
  props: {
    value: {
      type: [Number, Array],
      required: true,
    },
    min: {
      type: Number,
      required: false,
    },
    max: {
      type: Number,
      required: false,
    },
    step: {
      required: false,
    },
    readOnly: {
      type: Boolean,
      required: false,
      default: true,
    },
    isRangeSlider: {
      type: Boolean,
      required: true,
      default: false,
    },
  },
  data() {
    return {
      currentValue: this.isRangeSlider ? this.value : parseInt(
          this.$options.filters
            .percentageConvert(this.value, true, true)
            .slice(0, -1)
        ),
      colorCombination: colors.gradientSliderColors,
    }
  },
  computed: {
    localValue: {
      get() {
        return this.value
      },
      set(value) {
        this.$emit("input", value)
      },
    },
    currentColor: function () {
      if (this.currentValue < 8) return this.colorCombination[0]
      if (this.currentValue < 16) return this.colorCombination[1]
      if (this.currentValue < 24) return this.colorCombination[2]
      if (this.currentValue < 32) return this.colorCombination[3]
      if (this.currentValue < 40) return this.colorCombination[4]
      if (this.currentValue < 48) return this.colorCombination[5]
      if (this.currentValue < 56) return this.colorCombination[6]
      if (this.currentValue < 64) return this.colorCombination[7]
      if (this.currentValue < 72) return this.colorCombination[8]
      if (this.currentValue < 80) return this.colorCombination[9]
      if (this.currentValue < 88) return this.colorCombination[10]
      if (this.currentValue < 96) return this.colorCombination[11]
      return this.colorCombination[11]
    },
  },
  methods: {
    onFinalValue: function (value) {
      this.$emit("onFinalValue", value)
    },
  },
}
</script>

<style lang="scss" scoped>
.hux-range-slider {
  ::v-deep .v-input__control {
    .v-input__slot {
      .v-slider__track-container {
        height: 4px;
      }
      .lighten-3 {
        background-color: rgba(157, 212, 207, 0.25) !important;
      }
      .theme--light {
        .v-slider__track-fill {
          background-color: var(--v-persianGreen-base) !important;
        }
      }
      .v-slider__thumb {
        width: 16px;
        height: 16px;
        background-color: var(--v-white-base) !important;
        border: 1px solid var(--v-persianGreen-base);
        box-sizing: border-box;
        box-shadow: 0px 1px 5px rgb(0 0 0 / 15%);
        border-radius: 100px;
        border-color: var(--v-persianGreen-base) !important;
      }
      .v-slider__thumb-label {
        transform: translateY(35px) translateX(-50%) rotate(45deg) !important;
        background-color: inherit !important;
        color: var(--v-gray-base);
        border: none !important;
        font-size: 12px;
        line-height: 16px;
      }
    }
  }
}
.hux-score-slider {
  margin-left: 10px;
  margin-right: 10px;

  .slider-value-display {
    width: 28px;
    height: 16px;
    margin-top: 4px;
  }

  ::v-deep .v-slider__thumb {
    height: 16px;
    width: 16px;
    box-shadow: 0px 1px 5px rgb(0 0 0 / 25%);
    -webkit-appearance: none;
    appearance: none;

    &:before {
      left: -10px;
      top: -10px;
    }
  }

  ::v-deep .v-slider--horizontal {
    margin-left: 0px;

    .v-slider__track-container {
      width: 101%;
      height: 6px;
      left: -6px;
      transform: translateY(-50%);
      background: linear-gradient(0.25turn, #ec5b54, #ffcd00, #86bc25);
      border-radius: 5px;
    }

    .v-slider__track-background {
      border-radius: 5px;
      background: transparent !important;
    }

    .v-slider__track-fill {
      border-radius: 5px;
      background: transparent !important;
    }
  }
}
</style>
